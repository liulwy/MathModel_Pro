# 烟幕干扰弹投放策略模型 q1v2

## 1. 场景与坐标系

- **坐标系**：假目标位于原点 $O = (0,0,0)$，$z$ 轴垂直向上
- **真目标**：圆柱体，半径 $R = 7$ m，高度 $H = 10$ m
- **目标轴线端点与中心**：
  - 下底面圆心 $\mathbf{T}_{\text{bottom}} = (0, 200, 0)$
  - 上底面圆心 $\mathbf{T}_{\text{top}} = (0, 200, 10)$
  - 圆柱体中心 $\mathbf{T}_{\text{center}} = (0, 200, 5)$

### 云团参数
- 有效半径 $r_{\text{cloud}} = 10$ m
- 起爆时刻 $t_{\text{detonate}} = t_{\text{release}} + \Delta t = 1.5 + 3.6 = 5.1$ s
- 有效时间窗 $[t_{\text{detonate}}, t_{\text{detonate}} + t_{\text{window}}]$，其中 $t_{\text{window}} = 20$ s

## 2. 运动学模型

### 导弹（恒速直线运动）
- 初始位置 $\mathbf{M}_0 = (20000, 0, 2000)$
- 速度 $v_M = 300$ m/s
- 方向单位向量 $\hat{\mathbf{u}}_M = -\frac{\mathbf{M}_0}{\|\mathbf{M}_0\|}$
- 轨迹方程：
  $$\mathbf{M}(t) = \mathbf{M}_0 + v_M \cdot t \cdot \hat{\mathbf{u}}_M$$

### 无人机（恒速直线运动）
- 初始位置 $\mathbf{F}_0 = (17800, 0, 1800)$
- 速度 $v_F = 120$ m/s
- 方向单位向量 $\hat{\mathbf{u}}_F = -\frac{(F_{0x}, F_{0y}, 0)}{\|(F_{0x}, F_{0y}, 0)\|}$
- 轨迹方程：
  $$\mathbf{F}(t) = \mathbf{F}_0 + v_F \cdot t \cdot \hat{\mathbf{u}}_F$$

### 干扰弹（抛体运动）
- 投放时刻 $t_{\text{release}} = 1.5$ s
- 投放位置 $\mathbf{P}_{\text{rel}} = \mathbf{F}(t_{\text{release}})$
- 轨迹方程（$t \geq t_{\text{release}}$）：
  $$\mathbf{B}(t) = \mathbf{P}_{\text{rel}} + v_F (t - t_{\text{release}}) \hat{\mathbf{u}}_F + \left(0, 0, -\frac{1}{2}g(t - t_{\text{release}})^2\right)$$
  其中 $g = 9.8$ m/s²

### 云团中心（匀速下沉）
- 起爆点 $\mathbf{C}_{\text{det}} = \mathbf{B}(t_{\text{detonate}})$
- 轨迹方程（$t \geq t_{\text{detonate}}$）：
  $$\mathbf{C}(t) = \mathbf{C}_{\text{det}} + \left(0, 0, -v_{\text{sink}}(t - t_{\text{detonate}})\right)$$
  其中 $v_{\text{sink}} = 3$ m/s
- 有效球形范围：$$V(t) = \left\{ (x,y,z) \in \mathbb{R}^3 : (x - C_x(t))^2 + (y - C_y(t))^2 + (z - C_z(t))^2 \leq r_{\text{cloud}}^2 \right\}$$

## 3. 圆柱体表面采样

目标表面采样采用"按表面积比例分区 + 子面规则网格近似等面积"策略：

### 面积比例分配
- 侧面面积 $A_{\text{side}} = 2\pi R H$
- 顶面面积 $A_{\text{top}} = \pi R^2$
- 侧面点数 $N_{\text{side}} \approx N \cdot \frac{A_{\text{side}}}{A_{\text{side}} + A_{\text{top}}}$
- 顶面点数 $N_{\text{top}} = N - N_{\text{side}}$

### 侧面采样（圆柱侧面展开）
- 参数域：$z \in [0, H]$, $\theta \in [0, 2\pi)$
- 近似等面积网格：
  $$\begin{aligned}
  \text{num}_z &= \max\left(2, \left\lfloor \sqrt{\frac{N_{\text{side}}}{2\pi}} \right\rfloor\right) \\
  \text{num}_\theta &= \max\left(4, \left\lfloor \frac{N_{\text{side}}}{\text{num}_z} \right\rfloor\right)
  \end{aligned}$$
- 采样点：
  $$\mathbf{T}(z, \theta) = \left(T_{c,x} + R\cos\theta,\ T_{c,y} + R\sin\theta,\ z\right)$$
  其中 $z \in [z_{\min}, z_{\max}]$, $z_{\min} = T_{\text{center},z} - H/2$, $z_{\max} = T_{\text{center},z} + H/2$

### 顶面采样（极坐标网格）
- 半径 $r$ 线性等分，角度 $\theta$ 等分
- 采样点：
  $$\mathbf{T}(r, \theta) = \left(T_{c,x} + r\cos\theta,\ T_{c,y} + r\sin\theta,\ z_{\max}\right)$$
  其中 $r \in [0, R]$, $\theta \in [0, 2\pi)$

> **注**：严格等面积采样应采用 $r = R\sqrt{u}$ ($u \in [0,1]$)，当前实现为工程近似

## 4. 视线定义与最小距离

### 视线段定义
对每个采样点 $\mathbf{T}_j \in S$ 和导弹位置 $\mathbf{M}(t)$，定义视线段：
$$L_j(s; t) = \mathbf{T}_j + s \left[\mathbf{M}(t) - \mathbf{T}_j\right], \quad s \in [0,1]$$

### 最小距离计算
云团中心 $\mathbf{C}(t)$ 到线段 $L_j$ 的最小距离：
- 若 $\|\mathbf{TM}_j(t)\|^2 = 0$（$\mathbf{TM}_j(t) = \mathbf{M}(t) - \mathbf{T}_j$），则最近点为 $\mathbf{T}_j$
- 否则：
  $$\begin{aligned}
  s_j^*(t) &= \frac{\langle \mathbf{C}(t) - \mathbf{T}_j, \mathbf{M}(t) - \mathbf{T}_j \rangle}{\|\mathbf{M}(t) - \mathbf{T}_j\|^2} \\
  \hat{s}_j(t) &= \min\{1, \max\{0, s_j^*(t)\}\} \\
  \mathbf{P}_j(t) &= \mathbf{T}_j + \hat{s}_j(t) \left[\mathbf{M}(t) - \mathbf{T}_j\right] \\
  d_j(t) &= \|\mathbf{P}_j(t) - \mathbf{C}(t)\|
  \end{aligned}$$

代码返回距离平方数组 $\mathbf{d}^2(t) = [d_1^2(t), \dots, d_N^2(t)]$

> **特殊处理**：$t < t_{\text{detonate}}$ 时，$d_j^2(t) = +\infty$（防止误判）

## 5. 全视线遮蔽判据

时刻 $t$ 的遮蔽有效条件：
$$\max_j d_j^2(t) \leq r_{\text{cloud}}^2 \iff \forall j,\ d_j^2(t) \leq r_{\text{cloud}}^2$$

实现函数 `is_target_covered(t)`：
```python
d2_each = los_distance_sq_each_ray(t)
return all(d2_each <= r_cloud**2 + ε)
```

## 6. 时域求解与边界定位

### 时间离散化
- 时间窗：$[t_{\text{detonate}}, t_{\text{detonate}} + t_{\text{window}}]$
- 采样点：$K$ 个等距点 $t_k$（默认 $K=1000$）

### 遮蔽状态判定
$$\text{covered}(t_k) = 
\begin{cases} 
1, & \max_j d_j^2(t_k) \leq r_{\text{cloud}}^2 \\
0, & \text{否则}
\end{cases}$$

### 边界精确定位
- 定义符号函数：
  $$g(t) = 
  \begin{cases} 
  +1, & \text{covered}(t) = \text{True} \\
  -1, & \text{covered}(t) = \text{False}
  \end{cases}$$
- 在符号变化区间 $[t_a, t_b]$ 上使用二分法求根
- 替代方法：定义 $f(t) = \max_j d_j^2(t) - r_{\text{cloud}}^2$，使用牛顿法求根

### 总有效遮蔽时长
$$T_{\text{cover}} = \sum_{m} (b_m - a_m)$$

## 7. 复杂度与数值特性

### 计算复杂度
- $O(K \cdot N)$，其中 $K$ 为时间采样数，$N$ 为圆柱面采样点数（默认 $N=100$）
- 向量化实现降低常数因子

### 数值稳定性
1. 线段退化（$\mathbf{M}(t) = \mathbf{T}_j$）时避免除零
2. 判定时加入容差 $\epsilon \approx 10^{-12}$
3. $t < t_{\text{detonate}}$ 返回 $+\infty$ 防止误判
4. 二分法收敛阈值 $\text{tol} \approx 10^{-10}$

## 8. 可视化输出

### 3D 几何可视化
- 导弹、无人机、干扰弹、云团中心轨迹
- 圆柱侧面与顶面（半透明）
- 圆柱面采样点散点

### 时域分析可视化
- 覆盖状态随时间变化的 0/1 曲线
- 遮蔽区间填充色
- 文本输出各遮蔽区间与总时长

## 9. 采样方法数学说明与改进

### 侧面采样优化
理想格点选择（单元块近似正方形）：
$$\begin{aligned}
\text{num}_\theta &\approx \sqrt{N_{\text{side}} \cdot \frac{2\pi R}{H}} \\
\text{num}_z &\approx \sqrt{N_{\text{side}} \cdot \frac{H}{2\pi R}}
\end{aligned}$$

### 顶面采样优化
严格等面积采样：
- $r = R\sqrt{u}$，其中 $u \in [0,1]$ 均匀分布
- $\theta \sim \mathcal{U}[0, 2\pi)$
- 独立采样 $N_{\text{top}}$ 次

或分环采样：
- 第 $i$ 环半径 $r_i = R\sqrt{\frac{i}{N_{\text{rings}}}}$
- 角向样本数 $n_\theta(i) \propto r_i$

## 模型评价与推广

### 模型优势
1. **物理准确性**：圆柱体表面采样更符合真实目标几何
2. **全视线判定**：确保目标全方位遮蔽
3. **数值稳健性**：完善的边界处理和容错机制
4. **可视化支持**：多角度展示空间和时间特性

### 适用场景
1. 军事防御系统烟幕干扰策略优化
2. 无人机协同任务规划
3. 动态目标保护系统设计
4. 复杂几何体遮蔽效果评估

### 改进方向
1. **风场影响**：引入风致漂移项：
   $$\mathbf{C}(t) = \mathbf{C}_{\text{det}} + \mathbf{v}_{\text{wind}} (t - t_{\text{detonate}}) + (0, 0, -v_{\text{sink}} (t - t_{\text{detonate}}))$$
   
2. **云团扩散模型**：时变有效半径：
   $$r_{\text{eff}}(t) = r_0 \left[1 - e^{-k(t-t_{\text{detonate}})}\right]$$

3. **自适应采样**：在遮蔽边界附近加密采样

4. **多弹协同**：扩展至多枚干扰弹协同遮蔽：
   $$\text{covered}(t) = \min_j \left( \max_i d_{i,j}(t) \right) \leq r_{\text{eff}}$$



